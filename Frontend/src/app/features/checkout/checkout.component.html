<div class="checkout-container">
  <h1>Checkout</h1>

  <app-data-state
    [loading]="cartLoading()"
    [error]="cartError()"
    [hasData]="cart() !== null && !isEmpty()"
    loadingMessage="Loading your cartâ€¦"
    emptyMessage="Your cart is empty"
    errorTitle="Could not load cart."
  />

  @if (cart(); as cartData) {
    @if (!isEmpty()) {
      <app-sidebar-layout>
        <div main>
          <form (ngSubmit)="processCheckout()">
            <app-shipping-information-form [form]="shippingForm" />
            <app-shipping-options [form]="shippingForm2" [options]="shippingOptions" />
            <app-payment-method [form]="paymentForm" />

            @if (error()) {
              <div class="error-banner">
                {{ error() }}
              </div>
            }

            <div class="checkout-actions">
              <app-button type="button" (click)="goBackToCart()"> Back to Cart </app-button>
            </div>
          </form>
        </div>
        <div sidebar>
          <app-order-summary-panel
            [cart]="cart()"
            [additionalCost]="selectedShippingCost"
            [additionalCostLabel]="'Shipping'"
            [showItemDetails]="true"
            [ctaLabel]="isProcessing() ? 'Processing...' : 'Place Order'"
            [ctaDisabled]="!isFormValid || isProcessing()"
            (ctaClick)="processCheckout()"
          />
        </div>
      </app-sidebar-layout>
    }
  }
</div>
