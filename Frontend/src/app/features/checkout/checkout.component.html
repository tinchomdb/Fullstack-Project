<div class="checkout-container">
  <h1>Checkout</h1>

  <app-sidebar-layout>
    <div main>
      <form (ngSubmit)="processCheckout()" data-testid="checkout-form">
        <app-shipping-information-form
          [form]="checkout.shippingForm"
          [countries]="checkout.countries"
        />
        <app-shipping-options
          [form]="checkout.shippingOptionForm"
          [options]="checkout.shippingOptions"
        />
        <app-payment-method />

        @if (checkout.error()) {
          <div class="error-banner">
            {{ checkout.error() }}
          </div>
        }

        <div class="checkout-actions">
          <app-button
            type="button"
            (click)="processCheckout()"
            [disabled]="!checkout.canSubmit()"
            data-testid="checkout-submit-button"
          >
            {{ checkout.isProcessing() ? 'Processing...' : 'Place Order' }}
          </app-button>
        </div>
      </form>
    </div>
    <div sidebar>
      <app-order-summary-panel
        [cart]="checkout.cart()"
        [additionalCost]="checkout.selectedShippingCost() ?? 0"
        [additionalCostLabel]="'Shipping'"
        [showItemDetails]="true"
        [ctaLabel]="'Back to Cart'"
        (ctaClick)="goBackToCart()"
        data-testid="checkout-summary"
      />
    </div>
  </app-sidebar-layout>
</div>
