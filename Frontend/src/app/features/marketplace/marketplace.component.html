<section class="products-page" [attr.aria-labelledby]="headingId">
  @if (!activeCategory()) {
    <app-banner-carousel />
  }

  @if (displayedCategories().length > 0) {
    <app-featured-categories [heading]="pageHeading()" [categories]="displayedCategories()" />
  }

  @if (featuredProduct(); as featured) {
    <app-product-featured-card [product]="featured" />
  }

  @if (remainingProducts().length) {
    <div class="products-section">
      <div class="products-controls">
        <app-sort-dropdown />
      </div>
      <app-product-grid [products]="remainingProducts()" />

      @if (hasMore()) {
        <div
          class="scroll-sentinel"
          appIntersectionObserver
          (intersecting)="onLoadMore()"
          aria-hidden="true"
        >
          @if (loadingMore()) {
            <div class="loading-indicator">
              <div class="spinner"></div>
              <span>Loading more products...</span>
            </div>
          }
        </div>
      } @else if (!loadingMore() && remainingProducts().length > 0) {
        <div class="end-message">
          <p>You've reached the end of the catalog</p>
        </div>
      }
    </div>
  }
</section>
