<section class="products-page" [attr.aria-labelledby]="headingId">
  @if (activeCategory()) {
    <app-heading [content]="pageHeading()" [level]="'h1'" />
  }
  @if (!activeCategory()) {
    <app-banner-carousel />
  }

  @if (displayedCategories().length > 0) {
    <app-featured-categories [categories]="displayedCategories()" />
  }

  @if (featuredProduct().length > 0) {
    <app-featured-products [products]="featuredProduct()" />
  }

  @if (products().length) {
    <div class="products-section">
      <div class="products-controls">
        <app-heading [content]="'All Products'" [level]="'h2'" />
        <app-sort-dropdown />
      </div>
      <app-product-grid [products]="products()" />

      @if (hasMore()) {
        <div
          class="scroll-sentinel"
          appIntersectionObserver
          (intersecting)="onLoadMore()"
          aria-hidden="true"
        >
          @if (loadingMore()) {
            <div class="loading-indicator">
              <div class="spinner"></div>
              <span>Loading more products...</span>
            </div>
          }
        </div>
      } @else if (!loadingMore() && products().length > 0) {
        <div class="end-message">
          <p>You've reached the end of the catalog</p>
        </div>
      }
    </div>
  }
</section>
