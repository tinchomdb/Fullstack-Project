<!-- First Row: Logo, Search, Actions -->
<div class="navbar-top">
  <a class="logo" routerLink="/products" aria-label="Go to products">{{ title() }}</a>

  <app-search-bar class="search-bar-container" />

  <div class="navbar-actions">
    <app-auth-button></app-auth-button>
    <app-theme-toggle></app-theme-toggle>
    <app-cart-button [itemCount]="cartItemCount()"></app-cart-button>
    <app-hamburger-menu-button
      [isExpanded]="isMobileMenuOpen()"
      (toggle)="toggleMobileMenu()"
    ></app-hamburger-menu-button>
  </div>
</div>

<!-- Second Row: Category Selector and Category Links (Desktop only) -->
<div class="navbar-bottom">
  <app-category-selector />

  <nav class="categories-nav" aria-label="Categories">
    <ul>
      @for (category of categories(); track category.id) {
        <li>
          <a
            [routerLink]="['/products']"
            [queryParams]="{ categoryId: category.id }"
            routerLinkActive="is-active"
            [attr.aria-label]="'Browse ' + category.name"
          >
            {{ category.name }}
          </a>
        </li>
      }
    </ul>
  </nav>
</div>

<!-- Mobile Navigation Overlay -->
@if (isMobileMenuOpen()) {
  <div class="mobile-nav-overlay" (click)="closeMobileMenu()">
    <nav class="mobile-nav" aria-label="Mobile menu" (click)="$event.stopPropagation()">
      <!-- Close button -->
      <div class="mobile-nav-header">
        <app-close-button
          variant="default"
          size="lg"
          ariaLabel="Close menu"
          (clicked)="closeMobileMenu()"
        />
      </div>

      <ul>
        @for (item of navigation(); track item.path) {
          <li>
            <a
              routerLinkActive="is-active"
              [routerLinkActiveOptions]="{ exact: true }"
              #rla="routerLinkActive"
              [attr.aria-current]="rla.isActive ? 'page' : null"
              [routerLink]="item.path"
              [attr.aria-label]="item.ariaLabel"
              (click)="closeMobileMenu()"
            >
              {{ item.label }}
            </a>
          </li>
        }
      </ul>
      <div class="mobile-auth">
        <app-auth-button [additionalClick]="closeMobileMenu"></app-auth-button>
      </div>
    </nav>
  </div>
}
