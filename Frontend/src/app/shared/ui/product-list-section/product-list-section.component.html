@if (products().length) {
  <div class="products-section">
    <div class="products-controls">
      @if (showHeading()) {
        <app-heading [content]="heading()" [level]="headingLevel()" />
      }
      <app-sort-dropdown
        [currentValue]="currentSortValue()"
        [options]="sortOptions()"
        (sortChange)="onSortChange($event)"
      />
    </div>
    <app-product-grid
      [products]="products()"
      (addToCart)="onAddToCart($event)"
    />

    @if (hasMore() && !loadingMore()) {
      <div
        class="scroll-sentinel"
        appIntersectionObserver
        (intersecting)="onLoadMore()"
        aria-hidden="true"
      >
        <!-- Sentinel is only in DOM when ready to load -->
      </div>
    }

    @if (loadingMore()) {
      <app-loading-indicator message="Loading more products..." />
    }

    @if (!hasMore() && !loadingMore() && products().length > 0) {
      <div class="end-message">
        <p>{{ endMessage() }}</p>
      </div>
    }
  </div>
}
